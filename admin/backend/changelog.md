# Changelog

## [Unreleased]

### Added
- 在 SystemStatus 模型中添加了 uptime 字段
- 在系统状态 API 中添加了系统启动时间的获取功能
- 添加了统一的管理员账户管理工具 (admin_cli.py)
- 添加了缓存相关的测试用例
- 添加了评论相关的测试用例
- 添加了通用工具类的测试用例
- 添加了仪表盘相关的测试用例
- 添加了数据库初始化相关的测试用例
- 添加了日志相关的测试用例
- 添加了安全相关的测试用例
- 新增评论批量操作功能
  - 支持批量审核通过评论
  - 支持批量标记垃圾评论
  - 添加相关测试用例
- 添加了评论管理相关的功能
- 添加了评论的树状结构支持
- 添加了评论的批量操作功能
- 完善了所有模块的测试用例：
  - 用户模块：添加了用户状态和角色管理测试
  - 文章模块：添加了文章状态管理和排序测试
  - 评论模块：添加了评论排序和状态管理测试
  - 分类模块：添加了分类层级关系和排序测试
  - 标签模块：添加了标签合并和排序测试
  - 认证模块：添加了密码重置和邮件验证测试
  - 仪表板模块：添加了时间范围统计和趋势分析测试
- 提高了测试覆盖率至 95%

### Changed
- 修复了 dashboard 相关的测试用例
- 优化了系统状态数据的获取方式
- 删除了重复的 main.py，统一使用 run.py 作为启动入口
- 合并了 check_admin.py 和 reset_admin_password.py 到 admin_cli.py
- 修复了 run.py 的导入路径问题
- 修复了初始化数据中管理员用户的 is_superuser 字段
- 优化了日志配置，支持自定义日志目录
- 提高了测试覆盖率至 84.39%
- 修改评论批量操作的路由路径，使用连字符替代斜杠
- 优化评论状态更新逻辑，同时更新 `is_approved` 和 `is_spam` 状态
- 优化了全局异常处理机制
- 统一了 API 响应格式
- 改进了评论状态过滤的逻辑
- 完善了评论相关接口的错误处理
- 增强了评论管理的权限控制
- 优化了错误码定义，使其更符合 HTTP 标准：
  - 将资源冲突类错误码从 400 改为 409
  - 将实体状态错误类错误码从 400 改为 422
  - 将文件类型错误从 400 改为 415
  - 将文件大小错误从 400 改为 413
  - 将未激活用户错误从 400 改为 403
  - 完善了错误码的中文注释说明

### Removed
- 删除了本地文件上传相关配置和目录，完全迁移到七牛云存储
- 移除了 uploads 目录和相关的本地存储代码

### Fixed
- 修复评论批量操作的请求体验证问题
- 修复测试用例中的路由路径问题
- 修复了评论状态验证的问题
- 修复了评论删除时的权限检查问题
- 修复了评论移动时可能出现的循环引用问题
- 修复了全局异常处理器中的状态码问题