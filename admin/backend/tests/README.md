# 测试文档

## 测试规范

### 1. 命名规范

- 测试文件命名：`test_<module_name>.py`
- 测试类命名：`Test<ModuleName>`
- 测试方法命名：`test_<scenario_description>`

### 2. 测试组织结构

每个测试文件应包含：
- 模块级文档字符串，说明测试内容
- 必要的导入语句
- 测试数据和固定装置（fixtures）
- 按功能组织的测试类
- 清晰的测试方法注释

### 3. 测试用例编写规范

- 每个测试方法必须有清晰的文档字符串
- 使用统一的响应格式验证
- 使用统一的错误消息（来自 error_messages.py）
- 合理使用 pytest fixtures
- 保持测试数据的独立性

### 4. 响应格式规范

所有API响应必须遵循统一格式：
```python
{
    "code": int,      # 0表示成功，非0表示错误
    "message": str,   # 响应消息
    "data": Any       # 响应数据，错误时为None
}
```

### 5. 测试数据管理

- 使用工厂模式创建测试数据
- 每个测试方法执行后清理数据
- 避免测试间数据依赖
- 使用合适的测试数据范围

### 6. 错误处理规范

- 验证错误响应的完整性
- 检查错误码的正确性
- 确保错误消息使用统一语言
- 验证错误时data字段为None

### 7. 测试覆盖率要求

- 单元测试覆盖率 >= 80%
- 集成测试覆盖率 >= 60%
- 关键功能覆盖率 = 100%

## 运行测试

```bash
# 运行所有测试
pytest

# 运行特定模块测试
pytest tests/test_auth.py

# 运行带标记的测试
pytest -m "slow"

# 生成覆盖率报告
pytest --cov=app tests/
```

## 常见问题

1. 测试数据清理失败
   - 检查 setup/teardown 方法
   - 确认数据库回滚正常

2. 测试执行超时
   - 检查数据库连接
   - 排查无限循环

3. 测试结果不稳定
   - 检查测试数据独立性
   - 确认并发处理正确 